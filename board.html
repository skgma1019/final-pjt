<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“š ê²Œì‹œíŒ</title>
  <style>
  /* ê¸°ë³¸ ì„¤ì • */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  
  body {
    font-family: 'Arial', sans-serif;
    background-color: #1c1f24;  /* í´ë˜ì‹œë¡œì–„ ëŠë‚Œì˜ ì–´ë‘ìš´ ë°°ê²½ */
    color: #f4f6f9;  /* ë°ì€ ìƒ‰ìƒ í…ìŠ¤íŠ¸ */
    margin: 0;
    padding: 0;
  }
  
  /* ì œëª© ìŠ¤íƒ€ì¼ */
  h1 {
    text-align: center;
    font-size: 2rem;
    background-color: #0052a3; /* í´ë˜ì‹œë¡œì–„ì˜ íŒŒë‘ ìƒ‰ìƒ */
    color: #fff;
    padding: 20px 0;
    margin: 0;
    border-bottom: 5px solid #ffbb33; /* ê¸ˆìƒ‰ í•˜ë‹¨ì„  */
  }
  
  /* ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
  .container {
    width: 80%;
    margin: 0 auto;
    padding: 20px;
  }
  
  /* ê²Œì‹œê¸€ ì»¨í…Œì´ë„ˆ ê·¸ë¦¬ë“œ ì„¤ì • */
  .posts-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));  /* ê·¸ë¦¬ë“œ ì—´ ì„¤ì • */
    gap: 20px;  /* í•­ëª© ê°„ ê°„ê²© */
    padding: 20px 0;
    justify-items: center;  /* ì¹´ë“œë“¤ì´ ê· ë“±í•˜ê²Œ ë°°ì¹˜ë˜ë„ë¡ ì„¤ì • */
  }
  
  /* ê°œë³„ ê²Œì‹œê¸€ ìŠ¤íƒ€ì¼ */
  .post {
    background-color: #2d2f37;  /* í´ë˜ì‹œë¡œì–„ì˜ ì–´ë‘ìš´ íšŒìƒ‰ ë°°ê²½ */
    border: 2px solid #444d56; /* í´ë˜ì‹œë¡œì–„ì˜ ì–´ë‘ìš´ í…Œë‘ë¦¬ */
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    padding: 20px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    min-height: 250px;  /* ìµœì†Œ ë†’ì´ ì„¤ì • */
    width: 100%;  /* ì¹´ë“œì˜ ë„ˆë¹„ë¥¼ 100%ë¡œ ì„¤ì •í•˜ì—¬ grid ì•ˆì—ì„œ í™•ì¥ */
  }
  
  .post:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
  }
  
  /* ì œëª© ë§í¬ ìŠ¤íƒ€ì¼ */
  .post a {
    text-decoration: none;
    color: #f4f6f9;
  }
  
  .post a:hover {
    color: #ffbb33;  /* í´ë˜ì‹œë¡œì–„ì˜ ê¸ˆìƒ‰ ëŠë‚Œ */
  }
  
  /* ì œëª© ìŠ¤íƒ€ì¼ */
  .post h2 {
    font-size: 1.8rem;
    font-weight: bold;
    margin: 0 0 10px;
  }
  
  /* ì‘ì„±ì ë° ê²Œì‹œê¸€ ë©”íƒ€ ì •ë³´ ìŠ¤íƒ€ì¼ */
  .meta {
    color: #bbb;
    font-size: 0.9rem;
    margin-bottom: 10px;
  }
  
  .meta a {
    color: #0052a3;
    text-decoration: none;
  }
  
  /* ê²Œì‹œê¸€ ë‚´ìš© ìŠ¤íƒ€ì¼ */
  .post p {
    font-size: 1rem;
    line-height: 1.6;
    margin: 15px 0;
    flex-grow: 1;
  }
  
  /* ë²„íŠ¼ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
  .button-container {
    display: flex;
    justify-content: space-between;
    gap: 10px;
  }
  
  /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
  button {
    padding: 8px 15px;
    font-size: 1rem;
    border-radius: 5px;
    cursor: pointer;
    border: none;
    transition: all 0.3s;
  }
  
  /* ìˆ˜ì • ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
  .edit-btn {
    background-color: #ffc107; /* ìˆ˜ì • ë²„íŠ¼ì— í´ë˜ì‹œë¡œì–„ì˜ ê¸ˆìƒ‰ ì‚¬ìš© */
    color: white;
  }
  
  .edit-btn:hover {
    background-color: #ff9800;
  }
  
  /* ì‚­ì œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
  .delete-btn {
    background-color: #dc3545;  /* ì‚­ì œ ë²„íŠ¼ì— í´ë˜ì‹œë¡œì–„ì˜ ë¹¨ê°„ìƒ‰ ì‚¬ìš© */
    color: white;
  }
  
  .delete-btn:hover {
    background-color: #c82333;
  }
  
  /* ê¸€ì“°ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
  .write-btn {
    background-color: #28a745; /* ê¸€ì“°ê¸° ë²„íŠ¼ì— í´ë˜ì‹œë¡œì–„ì˜ ì´ˆë¡ìƒ‰ ì‚¬ìš© */
    color: white;
    margin: 20px 0;
    padding: 10px 20px;
    font-size: 1.2rem;
  }
  
  .write-btn:hover {
    background-color: #218838;
  }
  
  /* ì¹´í…Œê³ ë¦¬ í•„í„° ìŠ¤íƒ€ì¼ */
  select {
    padding: 5px;
    margin-bottom: 20px;
    background-color: #2d2f37;
    color: #f4f6f9;
    border: 1px solid #444d56;
  }
  
  /* "ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤" ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
  .no-posts {
    text-align: center;
    font-size: 1.5rem;
    color: #ffbb33;  /* ê¸ˆìƒ‰ í…ìŠ¤íŠ¸ */
    margin-top: 50px;
  }
  
  /* ë¯¸ë””ì–´ ì¿¼ë¦¬ */
  @media (max-width: 768px) {
    .posts-container {
      grid-template-columns: 1fr 1fr;  /* ì‘ì€ í™”ë©´ì—ì„œëŠ” ë‘ ì—´ë¡œ ë°°ì¹˜ */
    }
  }
  
  @media (max-width: 480px) {
    .posts-container {
      grid-template-columns: 1fr;  /* ë§¤ìš° ì‘ì€ í™”ë©´ì—ì„œëŠ” í•œ ì—´ë¡œ ë°°ì¹˜ */
    }
  }
  </style>
</head>
<body>
  <div id="nav"></div>

  <h1>ğŸ“š ê²Œì‹œê¸€ ëª©ë¡</h1>

  <label for="categoryFilter">ì¹´í…Œê³ ë¦¬ í•„í„°:</label>
  <select id="categoryFilter">
    <option value="">ì „ì²´</option>
    <option value="ë±ì¶”ì²œ">ë± ì¶”ì²œ</option>
    <option value="ì¹´ë“œì¶”ì²œ">ì¹´ë“œ ì¶”ì²œ</option>
    <option value="ì¡ë‹´">ì¡ë‹´</option>
  </select>

  <!-- ê¸€ì“°ê¸° ë²„íŠ¼ ì¶”ê°€ -->
  <button class="write-btn" id="writePostBtn">âœï¸ ê¸€ì“°ê¸°</button>

  <div class="container">
    <div class="posts-container" id="postsContainer">
      <!-- ê²Œì‹œê¸€ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
    </div>
    <div id="noPostsMessage" class="no-posts" style="display: none;">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>
  </div>

  <script src="nav.js"></script>
  <script>
    const API_URL = 'http://localhost:3000';

    document.addEventListener('DOMContentLoaded', () => {
      async function fetchPosts(category = '') {
        try {
          const url = category ? `${API_URL}/articles?category=${category}` : `${API_URL}/articles`;
          const response = await fetch(url);
          const posts = await response.json();
          if (posts.length === 0) {
            document.getElementById('noPostsMessage').style.display = 'block';
          } else {
            document.getElementById('noPostsMessage').style.display = 'none';
          }
          displayPosts(posts);
        } catch (error) {
          console.error('ê²Œì‹œê¸€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
        }
      }

      function displayPosts(posts) {
        const container = document.getElementById('postsContainer');
        container.innerHTML = '';

        posts.forEach(post => {
          const postElem = document.createElement('div');
          postElem.className = 'post';

          postElem.innerHTML = `
            <h2><a href="comment.html?articleId=${post.id}">${post.title}</a></h2>
            <div class="meta">
              ì‘ì„±ì: <a href="user_profile.html?userId=${post.user_id}">${post.nickname}</a> |
              ì‘ì„±ì¼: ${new Date(post.created_at).toLocaleString()} |
              ì¹´í…Œê³ ë¦¬: ${post.category} |
              ì¢‹ì•„ìš”: ${post.likes || 0}
            </div>
            <p>${post.content}</p>
            <div class="button-container">
              <button class="edit-btn" data-id="${post.id}" data-author="${post.user_id}">âœï¸ ìˆ˜ì •</button>
              <button class="delete-btn" data-id="${post.id}" data-author="${post.user_id}">ğŸ—‘ ì‚­ì œ</button>
            </div>
          `;

          container.appendChild(postElem);
        });
      }

      document.getElementById('categoryFilter').addEventListener('change', (e) => {
        const category = e.target.value;
        fetchPosts(category);
      });

      async function editPost(id, postAuthorId) {
        const token = localStorage.getItem('token');
        if (!token) {
          alert('ë¡œê·¸ì¸ í›„ì— í•˜ì„¸ìš”!');
          return;
        }

        // í˜„ì¬ ì‚¬ìš©ìì˜ IDë¥¼ ì–»ì–´ì˜´
        async function getCurrentUserIdFromToken(token) {
  try {
    const response = await fetch(`${API_URL}/users/me`, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`,
      },
    });

    const data = await response.json();
    if (!response.ok) throw new Error(data.error);

    return data.user.id;  // âœ… user.idë¡œ ì ‘ê·¼
  } catch (error) {
    console.error('í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
    return null;
  }
}


        // ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™, editId íŒŒë¼ë¯¸í„°ë¡œ ê²Œì‹œê¸€ ID ì „ë‹¬
        location.href = `write.html?editId=${id}`;
      }

      async function deletePost(id) {
        const token = localStorage.getItem('token');
        if (!token) {
          alert('ë¡œê·¸ì¸ í›„ì— í•˜ì„¸ìš”!');
          return;
        }

        if (confirm('ì •ë§ ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          try {
            const response = await fetch(`${API_URL}/articles/${id}`, {
              method: 'DELETE',
              headers: {
                'Authorization': `Bearer ${token}`,
              },
            });

            const data = await response.json();
            if (!response.ok) throw new Error(data.error);

            alert('ğŸ—‘ ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            fetchPosts();
          } catch (error) {
            alert('âŒ ' + error.message);
          }
        }
      }

      async function getCurrentUserIdFromToken(token) {
        try {
          const response = await fetch(`${API_URL}/users/me`, {
            method: 'GET',
            headers: {
              'Authorization': `Bearer ${token}`,
            },
          });

          const data = await response.json();
          if (!response.ok) throw new Error(data.error);
          return data.id; // ë°˜í™˜ë˜ëŠ” ë°ì´í„° êµ¬ì¡°ì— ë§ê²Œ ì¡°ì •í•´ì•¼ í•  ìˆ˜ ìˆìŒ
        } catch (error) {
          console.error('í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
          return null;
        }
      }

      // ê¸€ì“°ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ê¸€ì“°ê¸° í˜ì´ì§€ë¡œ ì´ë™
      document.getElementById('writePostBtn').addEventListener('click', () => {
        location.href = 'write.html';
      });

      document.getElementById('postsContainer').addEventListener('click', (event) => {
        const postId = event.target.getAttribute('data-id');
        const postAuthorId = event.target.getAttribute('data-author');

        if (event.target.classList.contains('edit-btn')) {
          editPost(postId, postAuthorId);
        } else if (event.target.classList.contains('delete-btn')) {
          deletePost(postId);
        }
      });

      fetchPosts(); // ìµœì´ˆ ê²Œì‹œê¸€ ë¡œë”©
    });
  </script>
</body>
</html>
